<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script src="../js/jquery-1.9.1.min.js"></script>
<link rel="stylesheet" href="../js/layui/css/layui.css" />
<link rel="stylesheet" href="../js/layui/css/modules/laydate/default/laydate.css">
<link rel="stylesheet" href="../js/layui/css/layui.css"  media="all">
<script type="text/javascript" src="../js/layui/layui.js"></script>
<script src="../js/layui/layui.all.js" charset="UTF-8"></script>
<body>

<table class="layui-hide" id="test" lay-filter="tblist"></table>

</body>
<script>
    $(function (){
        index();
    });
    function index(){
        layui.use(['table'], function(){
            var table = layui.table;
            table.render({
                elem: '#test'
                ,url:'../client/findCarGuanli'
                ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                ,limits : [3,5,7,9]
                ,limit : 3
                ,page:true
                ,cols: [
                    [
                        {field:'id',  title: 'ID', sort: true}
                        ,{field:'carNumber',  title: '车牌号'}
                        ,{field:'carXingName',  title: '型号'}
                        ,{field:'carXiangTi',  title: '厢体'}
                        ,{field:'carDangType', title: '档类型'}
                        ,{field:'carZuoWei', title: '座位'}
                        ,{field:'menDianName', title: '所在门店'}
                        ,{field:'carPrice', title: '日租价格'}
                        ,{field:'carType', title: '车辆状态',
                        templet: function (d) {
                            if (d.carType == 1) {
                                return "待租";
                            } else if (d.carType == 2) {
                                return "停用中";
                            } else if (d.carType == 3) {
                                return "待发车";
                            }else if (d.carType == 4) {
                                return "待收车";
                            }else {
                                return "";
                            }
                        }
                    }

                        ,{fixed: 'right',title:'操作', width:178, align:'center', toolbar: '#barDemo'}
                    ]
                ]
            });
            //通过添加监听
            table.on('tool(tblist)', function(obj) {
                data = obj.data;
                //然后data.你的值就可以了
                //alert(data.id);
            })
        });
    }
    var data;

</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="detail" href="javascript:findCarById(data.id)">查看详情</a>

    <a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="detail" href="javascript:getstop(data.id)">停用</a>

</script>
<script>
    //查看详情
    function anniu(id){
        alert(id);
    }
    //停用 getstop
    function getstop(id){
        $.ajax({
            url:'../client/updategetstop',
            type:'post',
            data:{id:id},
            success:function(data){
                if(data==1){
                    layer.msg('已停用');
                }
                location.reload();
            }, error:function(){
                layer.msg('停用失败');
            }
        })
    }
     function findCarById(id) {
                //示范一个公告层
                layer.open({
                    type: 1
                    ,
                    title: false //不显示标题栏
                    ,
                    closeBtn: false
                    ,
                    area: '400px;'
                    ,
                    shade: 0.8
                    ,
                    id: 'LAY_layuipro' //设定一个id，防止重复弹出
                    ,
                    btn: ['修改', '关闭']
                    ,
                    btnAlign: 'c'
                    ,
                    moveType: 1 //拖拽模式，0或者1
                    ,
                    content: getJspHtml("/client/findCarById?id="+id)
                    ,
                    success: function (layero) {
                        var btn = layero.find('.layui-layer-btn');
                        btn.find('.layui-layer-btn0').attr({
                            href: 'javascript:toxiugai('+id+')'
                            , target: '_blank'
                        });
                    }
                });
            }

    function toxiugai(id) {
        //示范一个公告层
        layer.open({
            type: 1
            ,
            title: false //不显示标题栏
            ,
            closeBtn: false
            ,
            area: '400px;'
            ,
            shade: 0.8
            ,
            id: 'LAY_layuiprp' //设定一个id，防止重复弹出
            ,
            btn: ['保存', '关闭']
            ,
            btnAlign: 'c'
            ,
            moveType: 1 //拖拽模式，0或者1
            ,
            content: getJspHtml("/client/toupdateCarXinXi?id="+id)
            ,
            success: function (layero) {
                var btn = layero.find('.layui-layer-btn');
                btn.find('.layui-layer-btn0').attr({
                    href: 'javascript:updatecar()'
                    , target: '_blank'
                });
            }
        });
    }
    //汽车详细信息修改
    function updatecar(){
        $.ajax({
            url:"/client/updatecar",
            data:$("#updateForm").serialize(),
            type:"post",
            success:function(data){
                layer.msg('修改成功');
            },error:function(){
                layer.msg('修改失败');
            }
        })
    }
    //  发送ajax请求获取jsp页面内容
    function getJspHtml(url){
        var  jspHtml = "";
        $.ajax({
            url :url,// 弹框里是：  /test/project/addPage.do
            type : "post",
            async:false,//需要注意的   应是同步请求
            success : function (data){
                //返回的data为     bootstarpDialog.jsp  的页面内容
                jspHtml = data;
            },error : function (){
                alert("ajax失败");
            }
        })
        //将data返回的jsp内容  填充到dialog方法的   message  属性中
        return jspHtml;
    }
</script>
<script>
    /**
     * 当前车辆的id 当订单状态为1 已完成时  当前车的租车辆+1
     */
    $(function () {
       updateZuCount(carId,status);//选中的车辆id和状态
    });
    function updateZuCount(carId,status){
        $.ajax({
            url:"/client/updateZuCount",
            data:{
                carId : carId,
                status : status
            },
            type:"post",
            success:function(data){
                if(data==1){
                    layer.msg('租车辆+1成功');
                }
            },error:function(){
                layer.msg('租车辆+1失败');
            }
        })


    }




</script>
</html>